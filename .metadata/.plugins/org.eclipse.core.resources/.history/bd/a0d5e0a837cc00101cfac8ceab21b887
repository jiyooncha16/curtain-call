<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.curtaincall.musical.mapper.MusicalMapper">

	<!-- 전체 리스트 조회-->
	<select id="selectAllMusical" resultType="Musical">
		SELECT * FROM musical
	</select>
	
	<!-- 개별 항목 조회 -->
	<select id="selectMusical" parameterType="int" resultType="Musical">
		SELECT * FROM musical
		WHERE musical_id = #{id} <!-- id 넣어도 되나? -->
	</select>
	
	<!-- 동적쿼리 : 검색 -->
	<select id="selectMusicalByCondition" parameterType="SearchCondition" resultType="Musical">
        SELECT * FROM musical as m
      	JOIN tag_connection as c
      	ON m.musical_id = c.musical_id
        JOIN hashtag as t
        ON c.tag_id = t.tag_id
      	
        <where>
            <if test="hashtag != null and hashtag.size() > 0">
                AND tag_id IN
                <foreach collection="hashtag" item="tag" open="(" separator="," close=")">
                    #{tag}
                </foreach>
            </if>
        </where>
        <choose>
            <when test="sortBy == 'random'">
                ORDER BY RAND()
            </when>
            <otherwise>
                ORDER BY ${sortBy} ${order}
            </otherwise>
        </choose>

    </select>
    
    <!-- 좋아요 있는지 확인 -->
    <select id="checkLike" resultType="int" parameterType="MusicalLikes">
    	SELECT count(*) FROM like_musical WHERE musical_id = #{musical_id}
    </select>
    
    <!-- 좋아요 등록 -->
    <insert id="insertLike" parameterType="MusicalLikes">
    	INSERT INTO like_musical VALUES (#{userId}, #{musicalId})
    </insert>
    
    <!-- 좋아요 삭제 -->
    <delete id="deleteLike" parameterType="com.ssafy.curtaincall.musical.dto.MusicalLikes">
    	DELETE FROM like_musical WHERE musical_id = #{musicalId} AND user_id = #{userId}
    </delete>

</mapper>