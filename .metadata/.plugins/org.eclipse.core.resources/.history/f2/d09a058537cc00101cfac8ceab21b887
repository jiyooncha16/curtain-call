package com.ssafy.curtaincall.musical.controller;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.ssafy.curtaincall.musical.dto.Musical;
import com.ssafy.curtaincall.musical.dto.MusicalLikes;
import com.ssafy.curtaincall.musical.dto.SearchCondition;
import com.ssafy.curtaincall.musical.service.MusicalService;

@RestController
@RequestMapping("/musicals")
@CrossOrigin("*")
public class MusicalController {
	
	/*
	 * 서비스 의존성 주입 필수 (@Autowired)
	 * 각 항목 정리해서 주석 상세하게 달기
	 * - 번호 정리
	 * - 각 항목의 파라미터와 리턴 값
	 * 
	 * RESTful 하게 작성 (get, post, put, delete)
	 * url에 주의할 것 (단, http메서드가 다르면 url은 겹쳐도 됨)
	 * 
	 * 리턴은 결과값 고려(수정됐는지, 리스트가 비었는지 등)하여
	 * ResponseEntity로 반환
	 * 
	 * 200(ok) : ResponseEntity.ok()
	 * 200(ok) + 리턴값 : ResponseEntity.ok(list)
	 * 
	 * 401(noContent) : ResponseEntity.noContent()
	 * 401(noContent) + 메시지 : ResponseEntity.status(HttpStatus.noContent).body("내용이 없습니다. (401)")
	 * 
	 * 404(notFound) : ResponseEntity.notFound()
	 * 404(notFound) + 메시지 : ResponseEntity.status(HttpStatus.notFound).body("요청하신 내용을 찾지 못했습니다. (404)")
	 */
	
	@Autowired
	MusicalService service;
	
	// 1. 조회
	/* 1-1. 전체 목록 조회
	 * 
	 *  메서드 : GET
	 *  엔드포인트 : /musicals
	 *  파라미터
	 *   - pathVariable(url) : 없음
	 *   - RequestBody(json) : 없음
	 *  리턴 : List<Musical> 뮤지컬 전체 목록
	 */
	@GetMapping("")
	public ResponseEntity<List<Musical>> getlist() {
		List<Musical> list = service.getlist();
		if (list == null || list.size() == 0) return ResponseEntity.noContent().build();
		return ResponseEntity.ok(list);
	}
	
	/* 1-2. 상세 조회
	 * 
	 *  메서드 : GET
	 *  엔드포인트 : /musicals/{id}
	 *  파라미터
	 *   - pathVariable(url) : 없음
	 *   - RequestBody(json) : 없음
	 *  리턴 : List<Musical> 뮤지컬 전체 목록
	 */
	@GetMapping("/{id}")
	public ResponseEntity<Musical> getMusical(@PathVariable int id) {
		Musical musical = service.getMusical(id);
		if (musical == null) return ResponseEntity.noContent().build();
		else return ResponseEntity.ok(musical);
	}
	
	/* 1-3. 필터링 조회 (검색)
	 * 
	 *  메서드 : GET
	 *  엔드포인트 : /musicals/{id}
	 *  파라미터
	 *   - pathVariable(url) : 없음
	 *   - RequestBody(json) : 없음
	 *  리턴 : List<Musical> 뮤지컬 전체 목록
	 *  
	 *  세부내용
	 *  - 필터링 : 해시태그별, 키워드별, 극장별, 날짜별
	 *  - 순서 : 좋아요 랜덤
	 *  - 페이징 : 몇페이지, 몇개씩
	 *  
	 *  사용처
	 *  - 검색
	 *  - 메인페이지(공연중 작품, 개막예정 작품, 추천리스트, 랜덤리스트, 핫랭킹 작품)
	 */
	@GetMapping("/search")
	public ResponseEntity<List<Musical>> getMusicalByCondition(@RequestBody SearchCondition condition) {
		List<Musical> list = service.getMusicalByCondition(condition);
		if (list == null || list.size() == 0) return ResponseEntity.noContent().build();
		else return ResponseEntity.ok(list);
	}
	
	// 2. 좋아요
	// 2-1. 좋아요 등록
	@PostMapping("/like")
	public void likeOn(@RequestBody MusicalLikes like) {
		service.likeOn(like);
	}
	
	// 2-2. 좋아요 해제
	@DeleteMapping("/like")
	public void likeOff(@RequestBody MusicalLikes like) {
		service.likeOff(like);
	}

}
